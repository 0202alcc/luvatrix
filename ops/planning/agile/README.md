# Agile Planning Source of Truth

This directory defines the canonical agile planning model for Luvatrix.

## Core files

1. `tasks_master.json`
- Single source of truth for all tasks.
- Each task can appear on multiple boards using `board_refs`.
- Dependency graph is defined by `depends_on`.

2. `boards_registry.json`
- Single source of truth for all board definitions and display rules.
- Defines how boards are filtered from `tasks_master.json`.
- Stores formatting defaults (columns, sort order, card fields, WIP limits).

3. `tasks_archived.json`
- Archived historical task ledger.
- Used when a milestone references tasks that are no longer active.

## Contract

1. Every task ID is globally unique (e.g., `T-1103`).
2. Every `board_ref` on a task must match a board `id` in `boards_registry.json`.
3. Milestone boards are generated by `milestone_id`; team and specialist boards are generated by `board_ref`.
4. Renderers/bots should not create new task data outside `tasks_master.json`.
5. Every milestone in `ops/planning/gantt/milestone_schedule.json` must include non-empty `task_ids`.
6. Every `task_id` in a milestone must exist in either `tasks_master.json` or `tasks_archived.json`.

## Update workflow

1. Prefer API-based updates:
- `uv run python ops/planning/api/planning_api.py <METHOD> <PATH> ...`
2. Add/update task records in `tasks_master.json` (or archive by API delete to `tasks_archived.json`).
3. Add/update board definition or formatting in `boards_registry.json`.
4. Ensure each milestone in `milestone_schedule.json` has correct `task_ids`.
5. Regenerate derived Gantt assets (automatic on API `--apply`).

## Validation

Run:

`uv run python ops/planning/agile/validate_milestone_task_links.py`
